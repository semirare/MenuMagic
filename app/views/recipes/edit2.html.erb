<%= form_with(model: @recipe, data: { turbo: true }) do |form| %>
  <div class="mx-auto md:w-2/3 w-full flex flex-col" id="edit_recipe">
    <%= render "form", recipe: @recipe %>
    <div class="flex my-5 justify-between gap-8">
      <%= turbo_frame_tag 'included_ingredients', class: 'w-3/4' do %>
        <div class="flex flex-col" id="included_ingredients">
          <% @recipe.recipe_ingredients.each do |recipe_ingredient| %>
            <%= render 'included_ingredient', recipe_ingredient: %>
          <% end %>
        </div>
      <% end %>
      <div class="flex flex-col w-1/4">
        <%= turbo_frame_tag 'unused_ingredients' do %>
          <div class="flex flex-col" id="unused_ingredients">
            <% @ingredients_not_in_recipe.each do |ingredient| %>
              <%= render 'unused_ingredient', ingredient:, recipe_id: @recipe.id %>
            <% end %>
          </div>
        <% end %>
        <div class="my-2 w-full">
          <%= render 'ingredients/form', ingredient: Ingredient.new %>
        </div>
      </div>
    </div>
    <%= form.submit "Save Recipe" %>
  </div>
<% end %>

<script>
  document.addEventListener("turbo:submit-end", function(event) {
    if (event.target.matches("[id='edit_recipe']")) {
      debugger;
      document.querySelectorAll("#included_ingredients form").forEach(function(form) {
        form.requestSubmit();
      });
    }
  });
</script>